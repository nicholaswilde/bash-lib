---
# https://taskfile.dev

version: '3'

vars:
  BATS: ./test/bats/bin/bats
  PORT: 8000

tasks:
  update:
    desc: Update git submodules
    cmds:
      - "cd test"
      - "git submodule update --init --recursive --remote"
  test:
    desc: Run bats-core tests
    cmds:
      - "{{ .BATS }} --tap test"
  test-lib:
    desc: Run bats-core tests on LIB
    cmds:
      - "{{ .BATS }} ./test/{{ .LIB }}.bats"
  new-test:
    desc: Create a new TEST from template
    cmds:
      - "cp ./templates/tests ./test/{{ .TEST }}.bats"
  new-script:
    desc: Create a new SCRIPT from template
    cmds:
      - "cp ./templates/script ./{{ .SCRIPT }}.sh"
      - "chmod +x ./{{ .SCRIPT }}.sh"
  new-lib:
    desc: Create a new LIB from template
    cmds:
      - "cp ./templates/lib ./{{ .LIB }}"
      - task: new-script
        vars:
          SCRIPT: "{{ .LIB }}"
      - task: new-test
        vars:
          TEST: "{{ .LIB }}"
  serve:
    desc: >-
      Start development server on http://0.0.0.0:{{ .PORT }} using
      Docker and mkdocs-material
    cmds:
      - >-
        docker run --rm -it -p {{ .PORT }}:{{ .PORT}} -v ${PWD}:/docs
        --platform linux/amd64 squidfunk/mkdocs-material serve
        --dev-addr 0.0.0.0:{{ .PORT }} -f ./mkdocs.yml
  default:
    cmds:
      - task -l
    silent: true
